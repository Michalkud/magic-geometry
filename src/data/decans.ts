// Decan system: Each zodiac sign (30°) is divided into three decans (10° each)
// Total: 36 decans, each ruled by a planet and associated with a pip card (2-10)

export type Decan = {
  id: string;
  number: number; // 1-36
  sign: string;
  signSymbol: string;
  decanNumber: number; // 1, 2, or 3 within the sign
  degrees: { start: number; end: number }; // 0-360
  dates: { start: string; end: string }; // Approximate dates (varies by year)
  ruler: string; // Planet ruling this decan
  rulerSymbol: string;
  card: string; // Associated Tarot card (2-10 of suits)
  cardId: string; // ID for linking
  title: string; // Traditional title
  description: string;
  element: 'Fire' | 'Water' | 'Air' | 'Earth';
  quality: 'Cardinal' | 'Fixed' | 'Mutable';
};

export const ZODIAC_SIGNS = [
  { name: 'Aries', symbol: '♈', element: 'Fire', quality: 'Cardinal' },
  { name: 'Taurus', symbol: '♉', element: 'Earth', quality: 'Fixed' },
  { name: 'Gemini', symbol: '♊', element: 'Air', quality: 'Mutable' },
  { name: 'Cancer', symbol: '♋', element: 'Water', quality: 'Cardinal' },
  { name: 'Leo', symbol: '♌', element: 'Fire', quality: 'Fixed' },
  { name: 'Virgo', symbol: '♍', element: 'Earth', quality: 'Mutable' },
  { name: 'Libra', symbol: '♎', element: 'Air', quality: 'Cardinal' },
  { name: 'Scorpio', symbol: '♏', element: 'Water', quality: 'Fixed' },
  { name: 'Sagittarius', symbol: '♐', element: 'Fire', quality: 'Mutable' },
  { name: 'Capricorn', symbol: '♑', element: 'Earth', quality: 'Cardinal' },
  { name: 'Aquarius', symbol: '♒', element: 'Air', quality: 'Fixed' },
  { name: 'Pisces', symbol: '♓', element: 'Water', quality: 'Mutable' },
];

export const DECANS: Decan[] = [
  // ARIES (March 21 - April 19)
  {
    id: 'aries-1',
    number: 1,
    sign: 'Aries',
    signSymbol: '♈',
    decanNumber: 1,
    degrees: { start: 0, end: 10 },
    dates: { start: 'Mar 21', end: 'Mar 30' },
    ruler: 'Mars',
    rulerSymbol: '♂',
    card: '2 of Wands',
    cardId: 'wands-2',
    title: 'Dominion',
    description: 'Pure martial force, initiative, leadership',
    element: 'Fire',
    quality: 'Cardinal',
  },
  {
    id: 'aries-2',
    number: 2,
    sign: 'Aries',
    signSymbol: '♈',
    decanNumber: 2,
    degrees: { start: 10, end: 20 },
    dates: { start: 'Mar 31', end: 'Apr 9' },
    ruler: 'Sun',
    rulerSymbol: '☉',
    card: '3 of Wands',
    cardId: 'wands-3',
    title: 'Virtue',
    description: 'Established strength, noble action',
    element: 'Fire',
    quality: 'Cardinal',
  },
  {
    id: 'aries-3',
    number: 3,
    sign: 'Aries',
    signSymbol: '♈',
    decanNumber: 3,
    degrees: { start: 20, end: 30 },
    dates: { start: 'Apr 10', end: 'Apr 19' },
    ruler: 'Venus',
    rulerSymbol: '♀',
    card: '4 of Wands',
    cardId: 'wands-4',
    title: 'Completion',
    description: 'Perfected work, celebration, harmony',
    element: 'Fire',
    quality: 'Cardinal',
  },

  // TAURUS (April 20 - May 20)
  {
    id: 'taurus-1',
    number: 4,
    sign: 'Taurus',
    signSymbol: '♉',
    decanNumber: 1,
    degrees: { start: 30, end: 40 },
    dates: { start: 'Apr 20', end: 'Apr 29' },
    ruler: 'Mercury',
    rulerSymbol: '☿',
    card: '5 of Disks',
    cardId: 'disks-5',
    title: 'Worry',
    description: 'Material anxiety, earthly concerns',
    element: 'Earth',
    quality: 'Fixed',
  },
  {
    id: 'taurus-2',
    number: 5,
    sign: 'Taurus',
    signSymbol: '♉',
    decanNumber: 2,
    degrees: { start: 40, end: 50 },
    dates: { start: 'Apr 30', end: 'May 9' },
    ruler: 'Moon',
    rulerSymbol: '☾',
    card: '6 of Disks',
    cardId: 'disks-6',
    title: 'Success',
    description: 'Material harmony, generosity, sharing',
    element: 'Earth',
    quality: 'Fixed',
  },
  {
    id: 'taurus-3',
    number: 6,
    sign: 'Taurus',
    signSymbol: '♉',
    decanNumber: 3,
    degrees: { start: 50, end: 60 },
    dates: { start: 'May 10', end: 'May 20' },
    ruler: 'Saturn',
    rulerSymbol: '♄',
    card: '7 of Disks',
    cardId: 'disks-7',
    title: 'Failure',
    description: 'Unfulfilled effort, lessons in patience',
    element: 'Earth',
    quality: 'Fixed',
  },

  // GEMINI (May 21 - June 20)
  {
    id: 'gemini-1',
    number: 7,
    sign: 'Gemini',
    signSymbol: '♊',
    decanNumber: 1,
    degrees: { start: 60, end: 70 },
    dates: { start: 'May 21', end: 'May 30' },
    ruler: 'Jupiter',
    rulerSymbol: '♃',
    card: '8 of Swords',
    cardId: 'swords-8',
    title: 'Interference',
    description: 'Scattered force, mental bondage',
    element: 'Air',
    quality: 'Mutable',
  },
  {
    id: 'gemini-2',
    number: 8,
    sign: 'Gemini',
    signSymbol: '♊',
    decanNumber: 2,
    degrees: { start: 70, end: 80 },
    dates: { start: 'May 31', end: 'Jun 9' },
    ruler: 'Mars',
    rulerSymbol: '♂',
    card: '9 of Swords',
    cardId: 'swords-9',
    title: 'Cruelty',
    description: 'Mental anguish, harsh truth',
    element: 'Air',
    quality: 'Mutable',
  },
  {
    id: 'gemini-3',
    number: 9,
    sign: 'Gemini',
    signSymbol: '♊',
    decanNumber: 3,
    degrees: { start: 80, end: 90 },
    dates: { start: 'Jun 10', end: 'Jun 20' },
    ruler: 'Sun',
    rulerSymbol: '☉',
    card: '10 of Swords',
    cardId: 'swords-10',
    title: 'Ruin',
    description: 'Mental defeat, rock bottom, rebirth pending',
    element: 'Air',
    quality: 'Mutable',
  },

  // CANCER (June 21 - July 22)
  {
    id: 'cancer-1',
    number: 10,
    sign: 'Cancer',
    signSymbol: '♋',
    decanNumber: 1,
    degrees: { start: 90, end: 100 },
    dates: { start: 'Jun 21', end: 'Jun 30' },
    ruler: 'Venus',
    rulerSymbol: '♀',
    card: '2 of Cups',
    cardId: 'cups-2',
    title: 'Love',
    description: 'Emotional union, partnership',
    element: 'Water',
    quality: 'Cardinal',
  },
  {
    id: 'cancer-2',
    number: 11,
    sign: 'Cancer',
    signSymbol: '♋',
    decanNumber: 2,
    degrees: { start: 100, end: 110 },
    dates: { start: 'Jul 1', end: 'Jul 11' },
    ruler: 'Mercury',
    rulerSymbol: '☿',
    card: '3 of Cups',
    cardId: 'cups-3',
    title: 'Abundance',
    description: 'Emotional fulfillment, friendship',
    element: 'Water',
    quality: 'Cardinal',
  },
  {
    id: 'cancer-3',
    number: 12,
    sign: 'Cancer',
    signSymbol: '♋',
    decanNumber: 3,
    degrees: { start: 110, end: 120 },
    dates: { start: 'Jul 12', end: 'Jul 22' },
    ruler: 'Moon',
    rulerSymbol: '☾',
    card: '4 of Cups',
    cardId: 'cups-4',
    title: 'Luxury',
    description: 'Emotional satiation, contemplation',
    element: 'Water',
    quality: 'Cardinal',
  },

  // LEO (July 23 - August 22)
  {
    id: 'leo-1',
    number: 13,
    sign: 'Leo',
    signSymbol: '♌',
    decanNumber: 1,
    degrees: { start: 120, end: 130 },
    dates: { start: 'Jul 23', end: 'Aug 1' },
    ruler: 'Saturn',
    rulerSymbol: '♄',
    card: '5 of Wands',
    cardId: 'wands-5',
    title: 'Strife',
    description: 'Conflict, competition, struggle',
    element: 'Fire',
    quality: 'Fixed',
  },
  {
    id: 'leo-2',
    number: 14,
    sign: 'Leo',
    signSymbol: '♌',
    decanNumber: 2,
    degrees: { start: 130, end: 140 },
    dates: { start: 'Aug 2', end: 'Aug 11' },
    ruler: 'Jupiter',
    rulerSymbol: '♃',
    card: '6 of Wands',
    cardId: 'wands-6',
    title: 'Victory',
    description: 'Triumph, recognition, success',
    element: 'Fire',
    quality: 'Fixed',
  },
  {
    id: 'leo-3',
    number: 15,
    sign: 'Leo',
    signSymbol: '♌',
    decanNumber: 3,
    degrees: { start: 140, end: 150 },
    dates: { start: 'Aug 12', end: 'Aug 22' },
    ruler: 'Mars',
    rulerSymbol: '♂',
    card: '7 of Wands',
    cardId: 'wands-7',
    title: 'Valor',
    description: 'Courage under pressure, defense',
    element: 'Fire',
    quality: 'Fixed',
  },

  // VIRGO (August 23 - September 22)
  {
    id: 'virgo-1',
    number: 16,
    sign: 'Virgo',
    signSymbol: '♍',
    decanNumber: 1,
    degrees: { start: 150, end: 160 },
    dates: { start: 'Aug 23', end: 'Sep 1' },
    ruler: 'Sun',
    rulerSymbol: '☉',
    card: '8 of Disks',
    cardId: 'disks-8',
    title: 'Prudence',
    description: 'Careful cultivation, skill development',
    element: 'Earth',
    quality: 'Mutable',
  },
  {
    id: 'virgo-2',
    number: 17,
    sign: 'Virgo',
    signSymbol: '♍',
    decanNumber: 2,
    degrees: { start: 160, end: 170 },
    dates: { start: 'Sep 2', end: 'Sep 11' },
    ruler: 'Venus',
    rulerSymbol: '♀',
    card: '9 of Disks',
    cardId: 'disks-9',
    title: 'Gain',
    description: 'Material increase, good fortune',
    element: 'Earth',
    quality: 'Mutable',
  },
  {
    id: 'virgo-3',
    number: 18,
    sign: 'Virgo',
    signSymbol: '♍',
    decanNumber: 3,
    degrees: { start: 170, end: 180 },
    dates: { start: 'Sep 12', end: 'Sep 22' },
    ruler: 'Mercury',
    rulerSymbol: '☿',
    card: '10 of Disks',
    cardId: 'disks-10',
    title: 'Wealth',
    description: 'Established prosperity, inheritance',
    element: 'Earth',
    quality: 'Mutable',
  },

  // LIBRA (September 23 - October 22)
  {
    id: 'libra-1',
    number: 19,
    sign: 'Libra',
    signSymbol: '♎',
    decanNumber: 1,
    degrees: { start: 180, end: 190 },
    dates: { start: 'Sep 23', end: 'Oct 2' },
    ruler: 'Moon',
    rulerSymbol: '☾',
    card: '2 of Swords',
    cardId: 'swords-2',
    title: 'Peace',
    description: 'Mental balance, truce, stalemate',
    element: 'Air',
    quality: 'Cardinal',
  },
  {
    id: 'libra-2',
    number: 20,
    sign: 'Libra',
    signSymbol: '♎',
    decanNumber: 2,
    degrees: { start: 190, end: 200 },
    dates: { start: 'Oct 3', end: 'Oct 12' },
    ruler: 'Saturn',
    rulerSymbol: '♄',
    card: '3 of Swords',
    cardId: 'swords-3',
    title: 'Sorrow',
    description: 'Heartbreak, separation, understanding',
    element: 'Air',
    quality: 'Cardinal',
  },
  {
    id: 'libra-3',
    number: 21,
    sign: 'Libra',
    signSymbol: '♎',
    decanNumber: 3,
    degrees: { start: 200, end: 210 },
    dates: { start: 'Oct 13', end: 'Oct 22' },
    ruler: 'Jupiter',
    rulerSymbol: '♃',
    card: '4 of Swords',
    cardId: 'swords-4',
    title: 'Truce',
    description: 'Rest from conflict, recovery',
    element: 'Air',
    quality: 'Cardinal',
  },

  // SCORPIO (October 23 - November 21)
  {
    id: 'scorpio-1',
    number: 22,
    sign: 'Scorpio',
    signSymbol: '♏',
    decanNumber: 1,
    degrees: { start: 210, end: 220 },
    dates: { start: 'Oct 23', end: 'Nov 1' },
    ruler: 'Mars',
    rulerSymbol: '♂',
    card: '5 of Cups',
    cardId: 'cups-5',
    title: 'Disappointment',
    description: 'Loss in pleasure, emotional setback',
    element: 'Water',
    quality: 'Fixed',
  },
  {
    id: 'scorpio-2',
    number: 23,
    sign: 'Scorpio',
    signSymbol: '♏',
    decanNumber: 2,
    degrees: { start: 220, end: 230 },
    dates: { start: 'Nov 2', end: 'Nov 11' },
    ruler: 'Sun',
    rulerSymbol: '☉',
    card: '6 of Cups',
    cardId: 'cups-6',
    title: 'Pleasure',
    description: 'Emotional harmony, nostalgia',
    element: 'Water',
    quality: 'Fixed',
  },
  {
    id: 'scorpio-3',
    number: 24,
    sign: 'Scorpio',
    signSymbol: '♏',
    decanNumber: 3,
    degrees: { start: 230, end: 240 },
    dates: { start: 'Nov 12', end: 'Nov 21' },
    ruler: 'Venus',
    rulerSymbol: '♀',
    card: '7 of Cups',
    cardId: 'cups-7',
    title: 'Debauch',
    description: 'Illusory success, corruption of pleasure',
    element: 'Water',
    quality: 'Fixed',
  },

  // SAGITTARIUS (November 22 - December 21)
  {
    id: 'sagittarius-1',
    number: 25,
    sign: 'Sagittarius',
    signSymbol: '♐',
    decanNumber: 1,
    degrees: { start: 240, end: 250 },
    dates: { start: 'Nov 22', end: 'Dec 1' },
    ruler: 'Mercury',
    rulerSymbol: '☿',
    card: '8 of Wands',
    cardId: 'wands-8',
    title: 'Swiftness',
    description: 'Rapid action, direct communication',
    element: 'Fire',
    quality: 'Mutable',
  },
  {
    id: 'sagittarius-2',
    number: 26,
    sign: 'Sagittarius',
    signSymbol: '♐',
    decanNumber: 2,
    degrees: { start: 250, end: 260 },
    dates: { start: 'Dec 2', end: 'Dec 11' },
    ruler: 'Moon',
    rulerSymbol: '☾',
    card: '9 of Wands',
    cardId: 'wands-9',
    title: 'Strength',
    description: 'Great inner strength, resilience',
    element: 'Fire',
    quality: 'Mutable',
  },
  {
    id: 'sagittarius-3',
    number: 27,
    sign: 'Sagittarius',
    signSymbol: '♐',
    decanNumber: 3,
    degrees: { start: 260, end: 270 },
    dates: { start: 'Dec 12', end: 'Dec 21' },
    ruler: 'Saturn',
    rulerSymbol: '♄',
    card: '10 of Wands',
    cardId: 'wands-10',
    title: 'Oppression',
    description: 'Overburdened force, responsibility',
    element: 'Fire',
    quality: 'Mutable',
  },

  // CAPRICORN (December 22 - January 19)
  {
    id: 'capricorn-1',
    number: 28,
    sign: 'Capricorn',
    signSymbol: '♑',
    decanNumber: 1,
    degrees: { start: 270, end: 280 },
    dates: { start: 'Dec 22', end: 'Dec 31' },
    ruler: 'Jupiter',
    rulerSymbol: '♃',
    card: '2 of Disks',
    cardId: 'disks-2',
    title: 'Change',
    description: 'Harmonious change, flexibility',
    element: 'Earth',
    quality: 'Cardinal',
  },
  {
    id: 'capricorn-2',
    number: 29,
    sign: 'Capricorn',
    signSymbol: '♑',
    decanNumber: 2,
    degrees: { start: 280, end: 290 },
    dates: { start: 'Jan 1', end: 'Jan 9' },
    ruler: 'Mars',
    rulerSymbol: '♂',
    card: '3 of Disks',
    cardId: 'disks-3',
    title: 'Works',
    description: 'Material establishment, construction',
    element: 'Earth',
    quality: 'Cardinal',
  },
  {
    id: 'capricorn-3',
    number: 30,
    sign: 'Capricorn',
    signSymbol: '♑',
    decanNumber: 3,
    degrees: { start: 290, end: 300 },
    dates: { start: 'Jan 10', end: 'Jan 19' },
    ruler: 'Sun',
    rulerSymbol: '☉',
    card: '4 of Disks',
    cardId: 'disks-4',
    title: 'Power',
    description: 'Earthly power, material security',
    element: 'Earth',
    quality: 'Cardinal',
  },

  // AQUARIUS (January 20 - February 18)
  {
    id: 'aquarius-1',
    number: 31,
    sign: 'Aquarius',
    signSymbol: '♒',
    decanNumber: 1,
    degrees: { start: 300, end: 310 },
    dates: { start: 'Jan 20', end: 'Jan 29' },
    ruler: 'Venus',
    rulerSymbol: '♀',
    card: '5 of Swords',
    cardId: 'swords-5',
    title: 'Defeat',
    description: 'Intellectual defeat, accepting limits',
    element: 'Air',
    quality: 'Fixed',
  },
  {
    id: 'aquarius-2',
    number: 32,
    sign: 'Aquarius',
    signSymbol: '♒',
    decanNumber: 2,
    degrees: { start: 310, end: 320 },
    dates: { start: 'Jan 30', end: 'Feb 8' },
    ruler: 'Mercury',
    rulerSymbol: '☿',
    card: '6 of Swords',
    cardId: 'swords-6',
    title: 'Science',
    description: 'Earned success, mental journey',
    element: 'Air',
    quality: 'Fixed',
  },
  {
    id: 'aquarius-3',
    number: 33,
    sign: 'Aquarius',
    signSymbol: '♒',
    decanNumber: 3,
    degrees: { start: 320, end: 330 },
    dates: { start: 'Feb 9', end: 'Feb 18' },
    ruler: 'Moon',
    rulerSymbol: '☾',
    card: '7 of Swords',
    cardId: 'swords-7',
    title: 'Futility',
    description: 'Unstable effort, mental fatigue',
    element: 'Air',
    quality: 'Fixed',
  },

  // PISCES (February 19 - March 20)
  {
    id: 'pisces-1',
    number: 34,
    sign: 'Pisces',
    signSymbol: '♓',
    decanNumber: 1,
    degrees: { start: 330, end: 340 },
    dates: { start: 'Feb 19', end: 'Feb 28' },
    ruler: 'Saturn',
    rulerSymbol: '♄',
    card: '8 of Cups',
    cardId: 'cups-8',
    title: 'Indolence',
    description: 'Abandoned success, spiritual seeking',
    element: 'Water',
    quality: 'Mutable',
  },
  {
    id: 'pisces-2',
    number: 35,
    sign: 'Pisces',
    signSymbol: '♓',
    decanNumber: 2,
    degrees: { start: 340, end: 350 },
    dates: { start: 'Mar 1', end: 'Mar 10' },
    ruler: 'Jupiter',
    rulerSymbol: '♃',
    card: '9 of Cups',
    cardId: 'cups-9',
    title: 'Happiness',
    description: 'Complete emotional satisfaction',
    element: 'Water',
    quality: 'Mutable',
  },
  {
    id: 'pisces-3',
    number: 36,
    sign: 'Pisces',
    signSymbol: '♓',
    decanNumber: 3,
    degrees: { start: 350, end: 360 },
    dates: { start: 'Mar 11', end: 'Mar 20' },
    ruler: 'Mars',
    rulerSymbol: '♂',
    card: '10 of Cups',
    cardId: 'cups-10',
    title: 'Satiety',
    description: 'Perfected emotional success',
    element: 'Water',
    quality: 'Mutable',
  },
];

// Helper functions
export function getDecanByDate(date: Date): Decan | undefined {
  const month = date.getMonth() + 1;
  const day = date.getDate();
  
  // Convert to day of year for easier comparison
  const dayOfYear = getDayOfYear(month, day);
  
  return DECANS.find(decan => {
    const startDay = dateStringToDayOfYear(decan.dates.start);
    const endDay = dateStringToDayOfYear(decan.dates.end);
    
    if (startDay <= endDay) {
      return dayOfYear >= startDay && dayOfYear <= endDay;
    } else {
      // Handle year boundary (e.g., Dec 22 - Jan 9)
      return dayOfYear >= startDay || dayOfYear <= endDay;
    }
  });
}

export function getDecanByDegree(degree: number): Decan | undefined {
  const normalizedDegree = ((degree % 360) + 360) % 360;
  return DECANS.find(decan => 
    normalizedDegree >= decan.degrees.start && 
    normalizedDegree < decan.degrees.end
  );
}

export function getDecansBySign(sign: string): Decan[] {
  return DECANS.filter(decan => decan.sign === sign);
}

export function getDecanByCard(cardId: string): Decan | undefined {
  return DECANS.find(decan => decan.cardId === cardId);
}

// Utility functions
function getDayOfYear(month: number, day: number): number {
  const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  let dayOfYear = day;
  for (let i = 0; i < month - 1; i++) {
    dayOfYear += daysInMonth[i];
  }
  return dayOfYear;
}

function dateStringToDayOfYear(dateStr: string): number {
  const months: Record<string, number> = {
    'Jan': 1, 'Feb': 2, 'Mar': 3, 'Apr': 4, 'May': 5, 'Jun': 6,
    'Jul': 7, 'Aug': 8, 'Sep': 9, 'Oct': 10, 'Nov': 11, 'Dec': 12
  };
  
  const [monthStr, dayStr] = dateStr.split(' ');
  const month = months[monthStr];
  const day = parseInt(dayStr);
  
  return getDayOfYear(month, day);
}